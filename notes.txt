# Development Notes

## 1. Player Combat & Survivability (`main.py`)
- Added `PLAYER_MAX_HEALTH` constant and extended `Player` with health, invulnerability timer, and `take_damage` routine.
- Movement logic now respects `alive` state; controls lock after death but gravity still resolves for a brief fall.
- Damage flashes the player sprite white and applies knockback plus hop feedback when hurt.
- Health HUD text renders in the top-right corner alongside the existing instruction list.
- Game-over overlay (semi-transparent fade with title + hint) appears once health reaches zero to provide clear failure feedback.

## 2. Enemy Awareness & Attacks (`main.py`)
- Replaced the static bump mechanic with contact damage that consumes player health unless you stomp enemies from above.
- Enemy updates now receive the player reference so they can aim knockback direction and state logic accordingly.
- Added attack cooldowns, timers, and ranged checks so enemies “charge” only when close enough, otherwise staying in patrol mode.

## 3. Enemy Navigation & Jumping AI (`main.py`)
- Introduced `random`-driven patrol timers so idle enemies occasionally change direction even without the player nearby.
- Added state machine (`patrol`, `chase`, `attack`) dictating movement speeds and direction overrides.
- Enemies now detect platform edges, remember the platform they occupy, and will jump off edges or toward higher platforms/players when needed (`_maybe_jump`, `_near_platform_edge`).
- Gravity/collision updates clamp enemies to ground level if they fall, keeping them roaming across the whole map.
- Instruction HUD updated to warn players that enemies can chase and jump.

## 4. Verification
- Ran `python3 -m py_compile main.py` after each feature batch to ensure syntax correctness since interactive gameplay testing isn’t available in this environment.

## 5. Enemy Movement Polish
- Added horizontal acceleration/velocity tracking so AI no longer snaps to their target speed; this removes jitter while keeping motion responsive.
- Boundary handling now clamps enemies gently at screen edges and zeros horizontal velocity to avoid visible warps.
- Patrol logic consults platform edge proximity (with configurable padding) before turning, and random direction flips only occur while grounded.
- Jump helper clears platform references whenever an enemy leaps, preventing stale data that previously caused erratic edge behavior.

## 6. Jump Collision Fixes
- Enemy movement now resolves horizontal and vertical collisions separately (mirroring the player logic), so when an enemy jumps and brushes a platform edge it no longer gets teleported sideways.
- Added historical position checks for vertical impacts to determine whether the enemy landed on top, hit from below, or just grazed the side, ensuring consistent placement after jumps.

## 7. Hollow Knight Visual Pass
- Added global color palette, gradient sky, parallax silhouettes, mist overlay, fireflies, and glowing HUD elements to echo Hollow Knight’s tone.
- Platform sprites now have cyan etching, player sprite renders cloaks/horns/shadow, enemies get additive glows, and UI font switch to orb-based health indicators.
- Ground + background surfaces are cached so the new effects remain performant.

## 8. Movement Upgrades
- Player gains sprint (Shift) and dash (Ctrl/J) with cooldown timers, gravity scaling, invulnerability flashes, and exhaust dust particles tied to movement speed.
- Dash logic includes direction locking, knockback-safe invulnerability window, and variable gravity to keep aerial control crisp.
- Dust particles are spawned via `GroundDustParticle` helper and rendered both from movement and dash bursts.

## 9. Website + Madlib Integration
- Landing page (Next.js) now embeds `landing-page/public/demo-game/index.html` via iframe, includes engine pipeline explaining how Madlib JSON feeds `demo-game/main.py`, and features generalized copy (no longer zombie-only).
- Madlib lab language updated to “lead/rival/hub” terminology while still outputting compatible JSON.
- Added documentation in README/INDEX to describe copying `demo-game/build/web` into the Next.js public folder so the playable iframe stays up to date.

## 10. Config-Driven Runtime
- Added `demo-game/game_config.json` plus a loader that deep-merges user payloads into sane defaults. Missing/invalid keys fall back, so untrusted JSON from the site can’t crash the engine.
- Player/enemy tuning (max health, run multiplier, dash speed, enemy base speed) now uses config values instead of hard-coded constants.
- Story metadata (lead, rival, hub, goals, game-over copy) is surfaced in HUD instructions and overlays, making it obvious how the Madlib lab influences the playable build. Config also accepts custom instruction lines and palette overrides.

## 11. Automated Build Helper
- Created `tools/build_game.py` CLI: `python tools/build_game.py --config payload.json --slug demo`.
- Script validates JSON, writes `demo-game/game_config.json`, runs `pygbag main.py`, and copies `demo-game/build/web` into `dist/<slug>/` so the site can ingest per-build bundles.
- Added README/INDEX notes describing the config file and the helper workflow to prepare for backend automation.

## 12. Backend Build Endpoint (landing-page/app/api/build)
- Next.js API route `/api/build` validates Madlib payloads with the shared Zod schema, writes a temp config, runs the Python helper (`tools/build_game.py`), and publishes bundles to `landing-page/public/generated/<slug>/`.
- Requires an environment with Python 3 + pygbag; configurable via `KYX_PYTHON`. Intended for local dev or custom workers (Vercel serverless may not support long-running pygbag builds without extra infra).
- README documents how to call the endpoint and warns about hosting implications.

## 13. Prompt-to-Config Generator
- Added `landing-page/lib/promptToConfig.ts` plus `/api/generate-config` for the “describe your game” flow. Simple keyword matching picks tone/difficulty, palette themes, and fallback names so we can generate a valid config without touching JSON or calling paid AI APIs.
- README now documents the endpoint so the UI can chain: prompt → config → `/api/build`.
